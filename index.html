
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kurumsal Anket Portalı</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fadeIn {
        animation: fadeIn 0.4s ease-out forwards;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
    </style>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body class="bg-green-50 text-gray-800 min-h-screen font-sans selection:bg-green-200">
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'react';
        import { createRoot } from 'react-dom/client';

        // --- CONSTANTS & CONFIG ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxaD2pCO5hy1TW0E4-iWdfkICMIcRmCtlOsL6dHmvnvYY2VwPnGtYqfXaHnV1G6R9R_/exec";
        const ADMIN_PASSWORD = "1839";

        const AIRCRAFTS = [
          { label: "T-70", id_suffix: "t70" },
          { label: "AT-802A", id_suffix: "at802a" },
          { label: "BELL 429", id_suffix: "bell429" },
          { label: "B-360", id_suffix: "b360" },
          { label: "C-650", id_suffix: "c650" }
        ];

        const INITIAL_QUESTIONS = [
          {
            id: 1,
            text: "Hava araçlarımızın bakımlarında uçuş teknisyenlerimizin iş yoğunluğu ağırlığı nedir?",
            sections: [
              { id: "1a", label: "a", title: "Periyodik Bakım", sectionWeight: 15, items: AIRCRAFTS.map(a => ({ id: `1a_${a.id_suffix}`, label: a.label })) },
              { id: "1b", label: "b", title: "Günlük Bakım", sectionWeight: 5, items: AIRCRAFTS.map(a => ({ id: `1b_${a.id_suffix}`, label: a.label })) },
              { id: "1c", label: "c", title: "Arızacılık Uygulamaları ve Sıklığı", sectionWeight: 5, items: AIRCRAFTS.map(a => ({ id: `1c_${a.id_suffix}`, label: a.label })) },
              { id: "1ç", label: "ç", title: "TB Yayınlanma ve Uygulama Sıklığı", sectionWeight: 5, items: AIRCRAFTS.map(a => ({ id: `1ç_${a.id_suffix}`, label: a.label })) }
            ]
          },
          {
            id: 2,
            text: "Personelin uçuş faaliyetlerinin hazırlık ve icrasına katılım yoğunluğu nedir?",
            sections: [
              { id: "2a", label: "a", title: "Yangın Söndürme Operasyonları", sectionWeight: 10, items: AIRCRAFTS.map(a => ({ id: `2a_${a.id_suffix}`, label: a.label })) },
              { id: "2b", label: "b", title: "VIP Komuta Kontrol Uçuşları", sectionWeight: 5, items: AIRCRAFTS.map(a => ({ id: `2b_${a.id_suffix}`, label: a.label })) },
              { id: "2c", label: "c", title: "Bilfiil Uçuşa Katılım Durumu", sectionWeight: 5, items: AIRCRAFTS.map(a => ({ id: `2c_${a.id_suffix}`, label: a.label })) },
              { id: "2ç", label: "ç", title: "Uçuş Öncesi ve Sonrası Faaliyetler", sectionWeight: 5, items: AIRCRAFTS.map(a => ({ id: `2ç_${a.id_suffix}`, label: a.label })) }
            ]
          },
          {
            id: 3,
            text: "Personelin ikamet ettiği yeri dışında görev yapma yoğunluğu nedir?",
            sections: [
              { id: "3a", label: "a", title: "Yaz Dönemi", sectionWeight: 15, items: AIRCRAFTS.map(a => ({ id: `3a_${a.id_suffix}`, label: a.label })) },
              { id: "3b", label: "b", title: "Kış Dönemi", sectionWeight: 5, items: AIRCRAFTS.map(a => ({ id: `3b_${a.id_suffix}`, label: a.label })) }
            ]
          },
          {
            id: 4,
            text: "Personelin uçuşa hazır bekleme faaliyetlerinin yoğunluğu nedir?",
            sections: [
              { id: "4a", label: "a", title: "Bekleme Faaliyetleri", sectionWeight: 10, items: AIRCRAFTS.map(a => ({ id: `4a_${a.id_suffix}`, label: a.label })) }
            ]
          },
          {
            id: 5,
            text: "Personelin idari faaliyet yoğunluğu nedir?",
            sections: [
              { id: "5a", label: "a", title: "İkmal Faaliyetleri ve Destek Teçhizatı Bakımı", sectionWeight: 8, items: AIRCRAFTS.map(a => ({ id: `5a_${a.id_suffix}`, label: a.label })) },
              { id: "5b", label: "b", title: "Sicil Takip ve Planlama", sectionWeight: 7, items: AIRCRAFTS.map(a => ({ id: `5b_${a.id_suffix}`, label: a.label })) }
            ]
          }
        ];

        const INITIAL_DATA = {
          welcomeText: "Uçuş Teknisyenleri İş Yoğunluğu Anketine Hoş Geldiniz.\n\nLütfen her bir kategori için ilgili hava aracına yönelik yoğunluk puanınızı 1 (En Düşük) ile 5 (En Yüksek) arasında giriniz.",
          questions: INITIAL_QUESTIONS,
          personnel: [],
          responses: []
        };

        // --- CLOUD SERVICE ---
        const CloudService = {
          async fetchData() {
            try {
              const response = await fetch(SCRIPT_URL);
              return await response.json();
            } catch (error) {
              console.error("Veri çekme hatası:", error);
              return null;
            }
          },
          async saveResponse(responseData) {
            return this.post({ action: "addResponse", data: responseData });
          },
          async updatePersonnel(personnelList) {
            return this.post({ action: "updatePersonnel", data: personnelList });
          },
          async updateConfig(welcomeText) {
            return this.post({ action: "updateConfig", data: { welcomeText } });
          },
          async updateWeights(weights) {
            return this.post({ action: "updateWeights", data: weights });
          },
          async post(payload) {
            try {
              await fetch(SCRIPT_URL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
              });
            } catch (error) {
              console.error("Veri gönderme hatası:", error);
            }
          }
        };

        // --- COMPONENTS ---

        const WelcomeView = ({ text, onStart }) => (
          <div className="bg-white p-8 rounded-xl shadow-lg border-t-4 border-green-600 text-center animate-fadeIn">
            <i className="fas fa-info-circle text-green-600 text-5xl mb-4"></i>
            <h2 className="text-2xl font-bold text-gray-800 mb-6 uppercase tracking-tighter">Bilgilendirme</h2>
            <div className="prose max-w-none text-gray-600 mb-8 whitespace-pre-wrap font-medium">
              {text}
            </div>
            <button
              onClick={onStart}
              className="bg-green-600 text-white px-10 py-3 rounded-full font-black text-lg hover:bg-green-700 transition-all shadow-md transform hover:scale-105 uppercase"
            >
              Başla
            </button>
          </div>
        );

        const SurveyForm = ({ questions, personnel, onSave, onCancel }) => {
          const [step, setStep] = useState(0);
          const [selectedPerson, setSelectedPerson] = useState('');
          const [searchTerm, setSearchTerm] = useState('');
          const [isDropdownOpen, setIsDropdownOpen] = useState(false);
          const [ratings, setRatings] = useState({});
          const dropdownRef = useRef(null);

          const handleRatingSelect = (itemId, value) => {
            setRatings(prev => ({ ...prev, [itemId]: value }));
          };

          const isStepComplete = () => {
            if (step === 0) return selectedPerson !== '';
            const currentQuestion = questions[step - 1];
            const itemIds = currentQuestion.sections.flatMap(s => s.items.map(i => i.id));
            return itemIds.every(id => ratings[id] !== undefined);
          };

          const handleNext = () => {
            if (isStepComplete()) {
              if (step < questions.length) {
                setStep(step + 1);
                window.scrollTo(0, 0);
              } else {
                handleSubmit();
              }
            } else {
              alert(step === 0 ? 'Lütfen personel seçiniz.' : 'Lütfen tüm alanları puanlayınız.');
            }
          };

          const handleSubmit = () => {
            let totalScore = 0;
            questions.forEach(q => {
              q.sections.forEach(s => {
                const sumRatings = s.items.reduce((sum, item) => sum + (ratings[item.id] || 0), 0);
                const avgRating = sumRatings / s.items.length;
                totalScore += avgRating * s.sectionWeight;
              });
            });

            onSave({
              id: crypto.randomUUID(),
              timestamp: new Date().toLocaleString('tr-TR'),
              personnelName: selectedPerson,
              scores: ratings,
              totalScore: Math.round(totalScore)
            });
          };

          const filteredPersonnel = personnel.filter(p => 
            p.toLowerCase().toLocaleLowerCase('tr-TR').includes(searchTerm.toLowerCase().toLocaleLowerCase('tr-TR'))
          );

          useEffect(() => {
            const handleClickOutside = (event) => {
              if (dropdownRef.current && !dropdownRef.current.contains(event.target)) setIsDropdownOpen(false);
            };
            document.addEventListener('mousedown', handleClickOutside);
            return () => document.removeEventListener('mousedown', handleClickOutside);
          }, []);

          return (
            <div className="bg-white p-6 md:p-12 rounded-[2.5rem] shadow-2xl border border-gray-100 relative overflow-hidden">
              <div className="absolute top-0 left-0 w-full h-3 bg-gray-100">
                <div className="h-full bg-green-600 transition-all duration-700 ease-in-out" style={{ width: `${(step / questions.length) * 100}%` }} />
              </div>

              <div className="pt-6 mb-12 flex justify-between items-end border-b-2 border-gray-50 pb-6">
                <div>
                  <h2 className="text-3xl font-black text-gray-900 tracking-tighter uppercase">Anket Formu</h2>
                  <p className="text-sm font-bold text-gray-400 mt-1 uppercase">Bölümleri sırayla doldurunuz</p>
                </div>
              </div>

              <div className="min-h-[400px]">
                {step === 0 ? (
                  <div className="space-y-6 animate-fadeIn">
                    <div className="bg-green-50 p-8 rounded-3xl border-2 border-green-200 shadow-inner">
                      <h3 className="text-xl font-black text-green-800 mb-6 flex items-center uppercase tracking-tight">
                        <i className="fas fa-id-card mr-3"></i> Personel Kimlik Girişi
                      </h3>
                      <div className="relative" ref={dropdownRef}>
                        <input 
                          type="text"
                          value={selectedPerson || searchTerm}
                          onChange={(e) => { setSearchTerm(e.target.value); setSelectedPerson(''); setIsDropdownOpen(true); }}
                          onFocus={() => setIsDropdownOpen(true)}
                          placeholder="İsim yazmaya başlayın..."
                          className="w-full p-5 border-2 border-green-300 rounded-2xl focus:ring-8 focus:ring-green-100 outline-none shadow-sm text-xl font-black text-green-900 bg-white"
                        />
                        {isDropdownOpen && (searchTerm || filteredPersonnel.length > 0) && (
                          <div className="absolute z-50 w-full mt-2 bg-white border-2 border-green-100 rounded-2xl shadow-2xl max-h-60 overflow-y-auto">
                            {filteredPersonnel.length > 0 ? filteredPersonnel.map(p => (
                              <div key={p} onClick={() => { setSelectedPerson(p); setSearchTerm(''); setIsDropdownOpen(false); }} className="p-4 hover:bg-green-50 cursor-pointer font-bold text-gray-700 border-b last:border-0 flex justify-between group">
                                <span>{p}</span><i className="fas fa-check text-green-500 opacity-0 group-hover:opacity-100"></i>
                              </div>
                            )) : <div className="p-4 text-gray-400 italic text-center">Eşleşen sonuç bulunamadı</div>}
                          </div>
                        )}
                      </div>
                    </div>
                  </div>
                ) : (
                  <div className="space-y-8 animate-fadeIn">
                    <div className="bg-green-800 text-white p-6 rounded-2xl shadow-xl">
                      <div className="text-[10px] font-black uppercase tracking-[0.2em] opacity-60 mb-2">BÖLÜM {step} / {questions.length}</div>
                      <h3 className="text-xl md:text-2xl font-black leading-tight">{questions[step-1].text}</h3>
                    </div>
                    {questions[step-1].sections.map(section => (
                      <div key={section.id} className="bg-gray-50/50 rounded-3xl p-6 border border-gray-100 space-y-6">
                        <h4 className="text-lg font-black text-gray-800 flex items-center border-b-2 border-green-100 pb-3 uppercase">
                          <span className="bg-black text-white w-8 h-8 rounded-lg inline-flex items-center justify-center mr-3 text-sm font-mono shadow-lg">{section.label}</span>
                          {section.title}
                        </h4>
                        <div className="grid grid-cols-1 gap-4">
                          {section.items.map(item => (
                            <div key={item.id} className="bg-white border border-gray-200 rounded-2xl p-5 shadow-sm flex flex-col sm:flex-row items-center justify-between gap-4 group">
                              <span className="text-gray-900 font-black text-lg group-hover:text-green-700">{item.label}</span>
                              <div className="flex space-x-2">
                                {[1, 2, 3, 4, 5].map(val => (
                                  <button key={val} type="button" onClick={() => handleRatingSelect(item.id, val)}
                                    className={`w-10 h-10 sm:w-12 sm:h-12 rounded-xl border-2 font-black transition-all flex items-center justify-center ${ratings[item.id] === val ? 'bg-green-600 border-green-700 text-white scale-110' : 'bg-white border-gray-200 text-gray-300 hover:text-green-500 hover:border-green-400'}`}
                                  >
                                    {val}
                                  </button>
                                ))}
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              <div className="mt-16 flex items-center justify-between pt-10 border-t-2 border-gray-100">
                <button type="button" onClick={() => (step > 0 ? setStep(step - 1) : onCancel())} className="flex items-center space-x-2 text-gray-400 font-black uppercase text-sm hover:text-red-500 transition-all">
                  <i className="fas fa-arrow-left"></i><span>{step === 0 ? 'İptal Et' : 'Geri Dön'}</span>
                </button>
                <button type="button" onClick={handleNext} disabled={!isStepComplete()} className={`px-12 py-5 rounded-2xl font-black text-xl flex items-center space-x-4 shadow-2xl transition-all ${isStepComplete() ? 'bg-green-600 text-white hover:bg-green-700' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`}>
                  <span>{step === questions.length ? 'KAYDET' : 'İLERİ'}</span><i className={`fas ${step === questions.length ? 'fa-save' : 'fa-chevron-right'}`}></i>
                </button>
              </div>
            </div>
          );
        };

        const AdminLogin = ({ onLoginSuccess, onCancel }) => {
          const [password, setPassword] = useState('');
          const [error, setError] = useState(false);
          const handleSubmit = (e) => {
            e.preventDefault();
            if (password === ADMIN_PASSWORD) onLoginSuccess();
            else { setError(true); setPassword(''); setTimeout(() => setError(false), 2000); }
          };
          return (
            <div className="max-w-md mx-auto mt-20 animate-fadeIn">
              <div className="bg-white p-8 rounded-3xl shadow-2xl border border-gray-100 text-center">
                <div className="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6"><i className="fas fa-lock text-3xl"></i></div>
                <h2 className="text-2xl font-black text-gray-800 mb-8 uppercase tracking-tighter">Yönetim Girişi</h2>
                <form onSubmit={handleSubmit} className="space-y-4">
                  <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} placeholder="Şifre" className={`w-full p-4 border-2 rounded-2xl text-center text-2xl tracking-[1em] outline-none transition-all ${error ? 'border-red-500 bg-red-50' : 'border-gray-100 focus:border-green-500'}`} autoFocus />
                  <button type="submit" className="w-full bg-green-600 text-white py-4 rounded-2xl font-black text-lg hover:bg-green-700 transition-all shadow-lg uppercase">Giriş Yap</button>
                  <button type="button" onClick={onCancel} className="text-gray-400 font-bold text-sm hover:text-gray-600 uppercase">İptal</button>
                </form>
              </div>
            </div>
          );
        };

        const AdminPanel = ({ data, updateData, onLogout }) => {
          const [activeTab, setActiveTab] = useState('REPORTS');
          const [personnelBulkText, setPersonnelBulkText] = useState('');

          const getRating = (res, sectionId, aircraftSuffix) => res.scores[`${sectionId}_${aircraftSuffix}`] || 0;
          const calculateScore = (res, suffix) => {
            let total = 0;
            data.questions.forEach(q => q.sections.forEach(s => { total += getRating(res, s.id, suffix) * s.sectionWeight; }));
            return Math.round(total);
          };

          const globalMaxScore = useMemo(() => {
            if (data.responses.length === 0) return 0;
            let max = 0;
            data.responses.forEach(res => AIRCRAFTS.forEach(air => { const s = calculateScore(res, air.id_suffix); if (s > max) max = s; }));
            return max;
          }, [data.responses, data.questions]);

          const exportToExcel = () => {
            let html = `<html><head><meta charset="utf-8"><style>.h{background:#15803d;color:#fff;font-weight:bold;border:1px solid #000;}.c{border:1px solid #ddd;}</style></head><body><table><thead><tr><th class="h">HAVA ARACI</th><th class="h">PERSONEL</th>${data.questions.flatMap(q => q.sections.map(s => `<th class="h">${q.id}${s.label}</th>`)).join('')}<th class="h">TOPLAM</th></tr></thead><tbody>${AIRCRAFTS.map(air => data.responses.map(res => `<tr><td class="c">${air.label}</td><td class="c">${res.personnelName}</td>${data.questions.flatMap(q => q.sections.map(s => `<td class="c">${getRating(res, s.id, air.id_suffix) * s.sectionWeight}</td>`)).join('')}<td class="c">${calculateScore(res, air.id_suffix)}</td></tr>`).join('')).join('')}</tbody></table></body></html>`;
            const blob = new Blob(['\ufeff', html], { type: 'application/vnd.ms-excel' });
            const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = 'Rapor.xls'; link.click();
          };

          return (
            <div className="bg-white rounded-[2rem] shadow-2xl overflow-hidden border border-gray-200 animate-fadeIn">
              <div className="bg-gradient-to-r from-green-900 to-green-700 p-8 text-white flex justify-between items-center">
                <div><h2 className="text-2xl font-black uppercase tracking-tighter">Sistem Yönetimi</h2></div>
                <button onClick={onLogout} className="bg-red-600 px-6 py-2 rounded-xl text-sm font-black uppercase tracking-widest transition-all shadow-xl hover:bg-red-700">Çıkış</button>
              </div>
              <div className="flex bg-gray-100 border-b p-1 overflow-x-auto scrollbar-hide">
                {[{id:'REPORTS',l:'RAPOR'},{id:'PERSONNEL',l:'PERSONEL'},{id:'QUESTIONS',l:'KATSAYI'},{id:'SETTINGS',l:'METİN'}].map(t => (
                  <button key={t.id} onClick={() => setActiveTab(t.id)} className={`flex-1 min-w-[120px] px-6 py-4 font-black text-xs transition-all rounded-xl ${activeTab === t.id ? 'bg-white shadow-sm text-green-800' : 'text-gray-400'}`}>{t.l}</button>
                ))}
              </div>
              <div className="p-8">
                {activeTab === 'REPORTS' && (
                  <div className="space-y-8">
                    <div className="flex justify-between items-center"><h3 className="text-xl font-black uppercase">Birim Bazlı Analiz</h3><button onClick={exportToExcel} className="bg-green-600 text-white px-6 py-2 rounded-xl text-xs font-black uppercase tracking-widest shadow-lg hover:bg-green-700">Excel İndir</button></div>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                      {AIRCRAFTS.map(air => {
                        const scores = data.responses.map(res => calculateScore(res, air.id_suffix));
                        const avg = scores.length > 0 ? scores.reduce((a,b)=>a+b,0) / scores.length : 0;
                        const pct = globalMaxScore > 0 ? ((avg / globalMaxScore) * 100).toFixed(1) : "0.0";
                        return (
                          <div key={air.id_suffix} className="bg-gray-50 p-6 rounded-3xl border border-gray-100">
                            <div className="flex justify-between items-start mb-4"><div><div className="text-lg font-black uppercase">{air.label}</div><div className="text-[10px] text-gray-400 font-black">{data.responses.length} KATILIM</div></div><div className="text-green-600 font-black text-xl">%{pct}</div></div>
                            <div className="h-2 bg-gray-200 rounded-full overflow-hidden"><div className="h-full bg-green-500" style={{width:`${pct}%`}}></div></div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                )}
                {activeTab === 'PERSONNEL' && (
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
                    <div className="space-y-4">
                      <h3 className="font-black uppercase text-lg">Personel Ekle</h3>
                      <textarea rows={8} value={personnelBulkText} onChange={(e)=>setPersonnelBulkText(e.target.value)} placeholder="Her satıra bir isim..." className="w-full p-4 border-2 border-gray-100 rounded-2xl font-bold outline-none focus:border-green-500" />
                      <button onClick={()=>{ const ns = personnelBulkText.split('\n').map(n=>n.trim()).filter(n=>n!==''); if(ns.length) updateData({ personnel: Array.from(new Set([...data.personnel, ...ns])) }); setPersonnelBulkText(''); }} className="w-full bg-green-600 text-white py-4 rounded-2xl font-black uppercase shadow-lg">Kaydet</button>
                    </div>
                    <div className="bg-gray-50 p-6 rounded-3xl border border-gray-200 overflow-y-auto max-h-[400px]">
                      <h3 className="font-black uppercase mb-4 border-b pb-2">Mevcut Liste ({data.personnel.length})</h3>
                      <div className="space-y-2">{data.personnel.map(p=>(<div key={p} className="bg-white p-3 rounded-xl border border-gray-100 flex justify-between text-xs font-black group"><span>{p}</span><button onClick={()=>updateData({ personnel: data.personnel.filter(x=>x!==p) })} className="text-red-300 opacity-0 group-hover:opacity-100 transition-opacity"><i className="fas fa-trash"></i></button></div>))}</div>
                    </div>
                  </div>
                )}
                {activeTab === 'QUESTIONS' && (
                  <div className="space-y-6">
                    {data.questions.map(q=>(
                      <div key={q.id} className="border-2 border-gray-50 rounded-3xl overflow-hidden shadow-sm">
                        <div className="bg-green-800 text-white p-4 font-black text-sm uppercase">Soru {q.id} Katsayıları</div>
                        <div className="p-4 grid grid-cols-2 md:grid-cols-4 gap-4">
                          {q.sections.map(s=>(
                            <div key={s.id} className="bg-green-50 p-4 rounded-2xl border-2 border-green-100 text-center">
                              <input type="number" value={s.sectionWeight} onChange={(e)=>{
                                const val = parseInt(e.target.value)||0;
                                updateData({ questions: data.questions.map(currQ => currQ.id === q.id ? {...currQ, sections: currQ.sections.map(currS => currS.id === s.id ? {...currS, sectionWeight: val} : currS)} : currQ) });
                              }} className="w-full text-center text-2xl font-black text-green-800 bg-transparent outline-none" />
                              <div className="text-[8px] text-gray-400 font-black uppercase mt-2">{s.title}</div>
                            </div>
                          ))}
                        </div>
                      </div>
                    ))}
                  </div>
                )}
                {activeTab === 'SETTINGS' && (
                  <div className="space-y-4">
                    <h3 className="font-black uppercase text-lg">Giriş Metni</h3>
                    <textarea rows={12} value={data.welcomeText} onChange={(e)=>updateData({ welcomeText: e.target.value })} className="w-full p-6 border-2 border-gray-100 rounded-3xl font-bold outline-none focus:border-green-500 shadow-inner" />
                  </div>
                )}
              </div>
            </div>
          );
        };

        const SurveyCompleted = () => (
          <div className="bg-white p-12 rounded-[2.5rem] shadow-2xl border border-gray-100 text-center animate-fadeIn mt-10">
            <div className="w-24 h-24 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-8 shadow-inner"><i className="fas fa-check-circle text-5xl"></i></div>
            <h2 className="text-3xl font-black text-gray-900 mb-4 uppercase tracking-tighter">Tamamlanmıştır</h2>
            <p className="text-xl font-bold text-green-700 mb-8 uppercase">Sayfayı kapatabilirsiniz.</p>
          </div>
        );

        // --- MAIN APP ---

        const App = () => {
          const [data, setData] = useState(() => {
            const saved = localStorage.getItem('survey_app_data');
            return saved ? JSON.parse(saved) : INITIAL_DATA;
          });
          const [view, setView] = useState('WELCOME');
          const [isAdminAuth, setIsAdminAuth] = useState(false);
          const [isLoading, setIsLoading] = useState(true);

          useEffect(() => {
            CloudService.fetchData().then(cloud => {
              if (cloud) {
                setData(prev => {
                  const updated = { ...prev };
                  if (cloud.personnel) updated.personnel = cloud.personnel;
                  const wc = cloud.config?.find(c => c.Key === 'welcomeText');
                  if (wc) updated.welcomeText = wc.Value;
                  if (cloud.responses) updated.responses = cloud.responses.map(r => ({ id: r.ID, timestamp: r.Timestamp, personnelName: r.PersonnelName, totalScore: parseInt(r.TotalScore), scores: JSON.parse(r.ScoresJSON) }));
                  if (cloud.weights) updated.questions = prev.questions.map(q => ({ ...q, sections: q.sections.map(s => { const cw = cloud.weights.find(w => w.SectionID === s.id); return cw ? { ...s, sectionWeight: parseInt(cw.Weight) } : s; }) }));
                  return updated;
                });
              }
              setTimeout(() => setIsLoading(false), 2000);
            });
          }, []);

          useEffect(() => { localStorage.setItem('survey_app_data', JSON.stringify(data)); }, [data]);

          const updateData = (newData) => {
            setData(prev => {
              const updated = { ...prev, ...newData };
              if (newData.personnel) CloudService.updatePersonnel(newData.personnel);
              if (newData.welcomeText) CloudService.updateConfig(newData.welcomeText);
              if (newData.questions) CloudService.updateWeights(newData.questions.flatMap(q => q.sections.map(s => ({ sectionId: s.id, weight: s.sectionWeight }))));
              return updated;
            });
          };

          if (isLoading) return (
            <div className="fixed inset-0 bg-white flex flex-col items-center justify-center z-[9999]">
              <div className="w-64 h-64 bg-white rounded-full shadow-2xl flex items-center justify-center mb-8 border border-gray-50">
                <img src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExeGZ0d3Rma3JncDZ6c2lxYnF6OGcwMGpwaTJ2YzdmYXdnNTFheG9naCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/1rrxPs1nb3IjwmbiXw/giphy.gif" className="w-48 h-48 object-contain" />
              </div>
              <p className="text-green-700 font-black text-2xl tracking-[0.2em] uppercase animate-pulse">Senkronize Ediliyor...</p>
            </div>
          );

          return (
            <div className="min-h-screen bg-green-50 pb-10">
              <nav className="bg-green-700 text-white p-4 shadow-xl flex justify-between items-center sticky top-0 z-50">
                <h1 className="text-lg md:text-xl font-black flex items-center cursor-pointer uppercase tracking-tighter" onClick={() => setView('WELCOME')}>
                  <i className="fas fa-poll-h mr-2"></i> Kurumsal Anket Portalı
                </h1>
                <button onClick={() => isAdminAuth ? setView('ADMIN') : setView('ADMIN_LOGIN')} className="bg-green-800 px-4 py-2 rounded-xl hover:bg-green-900 transition-all font-black text-xs uppercase shadow-lg">Admin Paneli</button>
              </nav>
              <main className="container mx-auto mt-8 px-4 max-w-4xl">
                {view === 'WELCOME' && <WelcomeView text={data.welcomeText} onStart={() => setView('SURVEY')} />}
                {view === 'SURVEY' && <SurveyForm questions={data.questions} personnel={data.personnel} onSave={async (r) => { setData(prev => ({...prev, responses: [...prev.responses, r]})); await CloudService.saveResponse(r); setView('COMPLETED'); }} onCancel={() => setView('WELCOME')} />}
                {view === 'ADMIN_LOGIN' && <AdminLogin onLoginSuccess={() => { setIsAdminAuth(true); setView('ADMIN'); }} onCancel={() => setView('WELCOME')} />}
                {view === 'ADMIN' && isAdminAuth && <AdminPanel data={data} updateData={updateData} onLogout={() => { setIsAdminAuth(false); setView('WELCOME'); }} />}
                {view === 'COMPLETED' && <SurveyCompleted />}
              </main>
            </div>
          );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
